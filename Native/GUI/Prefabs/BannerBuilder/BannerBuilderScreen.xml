<Prefab>
  <Constants>
    <Constant Name="NextButton.Width" BrushLayer="Default" BrushName="ButtonBrush1" BrushValueType="Width" />
    <Constant Name="NextButton.Height" BrushLayer="Default" BrushName="ButtonBrush1" BrushValueType="Height" />

    <Constant Name="PreviousButton.Width" BrushLayer="Default" BrushName="ButtonBrush2" BrushValueType="Width" />
    <Constant Name="PreviousButton.Height" BrushLayer="Default" BrushName="ButtonBrush2" BrushValueType="Height" />

    <Constant Name="Banner.Width" BrushLayer="Default" BrushName="ClanNaming.Stage.Banner" BrushValueType="Width" />
    <Constant Name="Banner.Height" BrushLayer="Default" BrushName="ClanNaming.Stage.Banner" BrushValueType="Height" />

    <Constant Name="Banner.Width.Scaled" MultiplyResult="0.3" Value="!Banner.Width" />
    <Constant Name="Banner.Height.Scaled" MultiplyResult="0.3" Value="!Banner.Height" />

    <Constant Name="Party.Banner.Width" BrushLayer="Default" BrushName="Nameplate.FlatBanner.Party" BrushValueType="Width" />
    <Constant Name="Party.Banner.Height" BrushLayer="Default" BrushName="Nameplate.FlatBanner.Party" BrushValueType="Height" />

    <Constant Name="Party.Banner.Width.Scaled" MultiplyResult="0.38" Value="!Party.Banner.Width" />
    <Constant Name="Party.Banner.Height.Scaled" MultiplyResult="0.49" Value="!Party.Banner.Height" />

    <Constant Name="Banner.Width.Alt" BrushLayer="Default" BrushName="Nameplate.FlatBanner.Big" BrushValueType="Width" />
    <Constant Name="Banner.Height.Alt" BrushLayer="Default" BrushName="Nameplate.FlatBanner.Big" BrushValueType="Height" />

    <Constant Name="Banner.Width.Scaled.Alt" MultiplyResult="0.62" Value="!Banner.Width.Alt" />
    <Constant Name="Banner.Height.Scaled.Alt" MultiplyResult="0.80" Value="!Banner.Height.Alt" />

    <Constant Name="Medium.Width" Value="210" />
    <Constant Name="Medium.Height" Value="45" />
    <Constant Name="Medium.BannerWidth" Value="!Medium.Height" />
    <Constant Name="Medium.BannerHeight" MultiplyResult="1.3333" Value="!Medium.BannerWidth"/>
  </Constants>
  <VisualDefinitions>
    <VisualDefinition Name="EditorLayersPanel" EaseType="EaseOut" EaseFunction="Quint" TransitionDuration="0.45">
      <VisualState MarginLeft="425" State="Default" />
      <VisualState MarginLeft="-440" State="Disabled" />
    </VisualDefinition>
    <VisualDefinition Name="EditorPreviewPanel" EaseType="EaseOut" EaseFunction="Quint" TransitionDuration="0.45">
      <VisualState MarginLeft="420" State="Default" />
      <VisualState MarginLeft="-430" State="Disabled" />
    </VisualDefinition>
  </VisualDefinitions>
  <Window>
    <Widget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" DoNotAcceptEvents="true">
      <Children>

        <!--Banner Preview Collapser-->
        <ToggleButtonWidget ButtonType="Toggle" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="80" SuggestedHeight="80" HorizontalAlignment="Right" VerticalAlignment="Bottom" MarginRight="15" MarginBottom="15" DoNotPassEventsToChildren="true" WidgetToClose="..\BannerPreview" DominantSelectedState="false" UpdateChildrenStates="true" IsSelected="@IsBannerPreviewsActive">
          <Children>
            <BoolBrushChangerBrushWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" FalseBrush="Panel.Toggler.Show.Banners" TrueBrush="Panel.Toggler.Hide.Banners" BooleanCheck="@IsBannerPreviewsActive"/>
          </Children>
        </ToggleButtonWidget>

        <ListPanel Id="BannerPreview" DataSource="{BannerImageIdentifier}" WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" SuggestedWidth="50" HorizontalAlignment="Right" VerticalAlignment="Bottom" MarginRight="25" MarginBottom="100" StackLayout.LayoutMethod="HorizontalRightToLeft">
          <Children>
            <MaskedTextureWidget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="!Banner.Width.Scaled" SuggestedHeight="!Banner.Height.Scaled" VerticalAlignment="Center" MarginRight="15" Brush="ClanNaming.Stage.Banner" AdditionalArgs="@AdditionalArgs" HideWhenNull="true" ImageId="@Id" TextureProviderName="@TextureProviderName"/>
            <MaskedTextureWidget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="!Banner.Width.Scaled.Alt" SuggestedHeight="!Banner.Height.Scaled.Alt" VerticalAlignment="Center" MarginRight="15" Brush="Flat.Tuple.Banner.Small.Hero" AdditionalArgs="@AdditionalArgs" ImageId="@Id" TextureProviderName="@TextureProviderName" IsDisabled="true"  />
            <MaskedTextureWidget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="85" SuggestedHeight="102" VerticalAlignment="Center" MarginRight="15" Brush="Kingdom.TornBanner.Big" AdditionalArgs="@AdditionalArgs" ImageId="@Id" TextureProviderName="@TextureProviderName"  />
            <!--<MaskedTextureWidget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="!Party.Banner.Width.Scaled" SuggestedHeight="!Party.Banner.Height.Scaled" VerticalAlignment="Center" MarginRight="15" Brush="Nameplate.FlatBanner.Party" AdditionalArgs="@AdditionalArgs" ImageId="@Id" TextureProviderName="@TextureProviderName" IsDisabled="true" />-->
            <MaskedTextureWidget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="!Medium.BannerWidth" SuggestedHeight="!Medium.BannerHeight" VerticalAlignment="Center" MarginRight="15" Brush="Nameplate.FlatBanner.Normal" AdditionalArgs="@AdditionalArgs" ImageId="@Id" TextureProviderName="@TextureProviderName" IsDisabled="true" />
            <MaskedTextureWidget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="50" SuggestedHeight="50" VerticalAlignment="Center" MarginRight="15" Brush="BannerBuilder.Agent.Banner" AdditionalArgs="@AdditionalArgs" ImageId="@Id" TextureProviderName="@TextureProviderName" IsDisabled="true" />
          </Children>
        </ListPanel>

        <!--Layers Panel Extension-->
        <BrushWidget Id="LayersPanel" VisualDefinition="EditorLayersPanel" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="235" SuggestedHeight="350" HorizontalAlignment="Left" VerticalAlignment="Top" MarginTop="581" Brush="Panel.Background" ExtendLeft="50">
          <Children>
            <BrushWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent"/>

            <ListPanel DataSource="{CurrentSelectedLayer}" WidthSizePolicy="Fixed" HeightSizePolicy="CoverChildren" SuggestedWidth="50" HorizontalAlignment="Right" VerticalAlignment="Top" MarginRight="25" MarginTop="25" StackLayout.LayoutMethod="VerticalBottomToTop">
              <Children>
                <!--Draw Stroke-->
                <ButtonWidget DoNotPassEventsToChildren="true" UpdateChildrenStates="true" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="50"  SuggestedHeight="36" MarginBottom="10" Brush="FaceGen.Extension.Button" ButtonType="Toggle" IsSelected="@IsDrawStrokeActive" IsHidden="@IsLayerPattern">
                  <Children>
                    <BrushWidget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="29" SuggestedHeight="29" HorizontalAlignment="Center" VerticalAlignment="Center" Brush="Layer.Option.DrawStroke"/>
                    <HintWidget DataSource="{..\DrawStrokeHint}" WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" Command.HoverBegin="ExecuteBeginHint" Command.HoverEnd="ExecuteEndHint" IsEnabled="false" />
                  </Children>
                </ButtonWidget>

                <!--Mirror-->
                <ButtonWidget DoNotPassEventsToChildren="true" UpdateChildrenStates="true" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="50"  SuggestedHeight="36" MarginBottom="10" Brush="FaceGen.Extension.Button" ButtonType="Toggle" IsSelected="@IsMirrorActive" IsHidden="false">
                  <Children>
                    <BrushWidget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="29" SuggestedHeight="29" HorizontalAlignment="Center" VerticalAlignment="Center" Brush="Layer.Option.Mirror"/>
                    <HintWidget DataSource="{..\MirrorHint}" WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" Command.HoverBegin="ExecuteBeginHint" Command.HoverEnd="ExecuteEndHint" IsEnabled="false" />
                  </Children>
                </ButtonWidget>

                <!--Center-->
                <ButtonWidget DoNotPassEventsToChildren="true" UpdateChildrenStates="true" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="50"  SuggestedHeight="36" MarginBottom="10" Brush="FaceGen.Extension.Button" Command.Click="ExecuteCenterSigil" IsHidden="false">
                  <Children>
                    <BrushWidget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="25" SuggestedHeight="25" HorizontalAlignment="Center" VerticalAlignment="Center" Brush="Layer.Option.AlignCenter"/>
                    <HintWidget DataSource="{..\CenterHint}" WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" Command.HoverBegin="ExecuteBeginHint" Command.HoverEnd="ExecuteEndHint" IsEnabled="false" />
                  </Children>
                </ButtonWidget>

                <!--Reset Size-->
                <ButtonWidget DoNotPassEventsToChildren="true" UpdateChildrenStates="true" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="50"  SuggestedHeight="36" MarginBottom="10" Brush="FaceGen.Extension.Button" Command.Click="ExecuteResetSize" IsHidden="false">
                  <Children>
                    <BrushWidget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="29" SuggestedHeight="29" HorizontalAlignment="Center" VerticalAlignment="Center" Brush="Layer.Option.ResetSize"/>
                    <HintWidget DataSource="{..\ResetSizeHint}" WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" Command.HoverBegin="ExecuteBeginHint" Command.HoverEnd="ExecuteEndHint" IsEnabled="false" />
                  </Children>
                </ButtonWidget>

                <!--Color Control-->
                <ListPanel WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" StackLayout.LayoutMethod="VerticalBottomToTop"  VerticalAlignment="Center">
                  <Children>

                    <!--Color1-->
                    <ColorButtonWidget DoNotPassEventsToChildren="true" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="35" SuggestedHeight="35" MarginLeft="3" MarginRight="3" MarginTop="3" MarginBottom="3" HorizontalAlignment="Center" VerticalAlignment="Center" Brush="Creation.ColorCard" ColorToApply="@Color1AsStr" UpdateChildrenStates="true" Command.Click="ExecuteSelectColor1" >
                      <Children>
                        <ImageWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" Brush="Creation.ColorCard.Selection"/>
                      </Children>
                    </ColorButtonWidget>

                    <!--Switch Colors Button-->
                    <ButtonWidget Id="SwitchColorsButton" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="35" SuggestedHeight="37" HorizontalAlignment="Center" Command.Click="ExecuteSwapColors" Brush="Creation.SwitchColor" GamepadNavigationIndex="0"/>

                    <!--Color 2-->
                    <ColorButtonWidget DoNotPassEventsToChildren="true" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="35" SuggestedHeight="35" MarginLeft="3" MarginRight="3" MarginTop="3" MarginBottom="3" HorizontalAlignment="Center" VerticalAlignment="Center" Brush="Creation.ColorCard" ColorToApply="@Color2AsStr" UpdateChildrenStates="true" Command.Click="ExecuteSelectColor2" >
                      <Children>
                        <ImageWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" Brush="Creation.ColorCard.Selection"/>
                      </Children>
                    </ColorButtonWidget>

                  </Children>
                </ListPanel>

              </Children>
            </ListPanel>

            <!--Layers-->
            <BrushWidget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="125" SuggestedHeight="310" MarginLeft="30" MarginTop="20" Brush="Panel.Dent" VerticalAlignment="Top" HorizontalAlignment="Left">
              <Children>

                <ScrollablePanel Id="ScrollablePanel" WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" AutoHideScrollBars="true" ClipRect="ClipRect" MarginLeft="5" MarginTop="5" MarginBottom="5" InnerPanel="ClipRect\LayerControl" VerticalScrollbar="..\VerticalScrollbar" Command.Drop="ExecuteReorderToEndWithParameters" CommandParameter.Drop="Self" AcceptDrop="true">
                  <Children>

                    <Widget Id="ClipRect" WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" ClipContents="true">
                      <Children>

                        <ListPanel WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" StackLayout.LayoutMethod="VerticalBottomToTop" Id="LayerControl"  MarginTop="5">
                          <Children>

                            <ListPanel DataSource="{Layers}"  WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" StackLayout.LayoutMethod="VerticalBottomToTop" Command.Drop="..\ExecuteReorderWithParameters" CommandParameter.Drop="Self" AcceptDrop="true">
                              <!--Background Layer-->
                              <ItemTemplate Type="First">
                                <BannerBuilderBackgroundLayerItem />
                              </ItemTemplate>
                              
                              <!--Sigil Layers-->
                              <ItemTemplate>
                                <BannerBuilderSigilLayerItem />
                              </ItemTemplate>
                            </ListPanel>

                            <!--Add Layer Button-->
                            <ButtonWidget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="100" SuggestedHeight="50" HorizontalAlignment="Left" MarginTop="5" MarginBottom="55" Command.Click="ExecuteAddDefaultLayer" UpdateChildrenStates="true" DoNotPassEventsToChildren="true">
                              <Children>
                                <BrushWidget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="40" SuggestedHeight="40" HorizontalAlignment="Center" VerticalAlignment="Center" Brush="BannerBuilder.AddLayer.Button"/>
                              </Children>
                            </ButtonWidget>

                          </Children>
                        </ListPanel>

                      </Children>
                    </Widget>

                    <!--Scroll Gradient-->
                    <!--<Widget DoNotAcceptEvents="true" WidthSizePolicy="StretchToParent" HeightSizePolicy="Fixed" SuggestedHeight="57" HorizontalAlignment="Right" PositionXOffset="-4" VerticalAlignment="Bottom" Sprite="General\CharacterCreation\character_creation_scroll_gradient" IsEnabled="false"/>-->

                  </Children>
                </ScrollablePanel>

                <ScrollbarWidget Id="VerticalScrollbar" WidthSizePolicy="Fixed" HeightSizePolicy="StretchToParent" SuggestedWidth="8" HorizontalAlignment="Right" VerticalAlignment="Top" MarginTop="6" MarginRight="5" MarginBottom="15" AlignmentAxis="Vertical" Handle="VerticalScrollbarHandle" MaxValue="100" MinValue="0" >
                  <Children>
                    <Widget WidthSizePolicy="Fixed" HeightSizePolicy="StretchToParent" SuggestedWidth="4" HorizontalAlignment="Center" Sprite="BlankWhiteSquare_9" Color="#5a4033FF" AlphaFactor="0.2" />
                    <ImageWidget Id="VerticalScrollbarHandle" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedHeight="10" SuggestedWidth="8" HorizontalAlignment="Center" Brush="FaceGen.Scrollbar.Handle" />
                  </Children>
                </ScrollbarWidget>

              </Children>
            </BrushWidget>

          </Children>
        </BrushWidget>

        <BrushWidget Id="TransformPanel" VisualDefinition="EditorPreviewPanel" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="560" SuggestedHeight="570" HorizontalAlignment="Left" VerticalAlignment="Top" MarginTop="12" Brush="Panel.Background">
          <Children>

            <!--Banner Tableau-->
            <BrushWidget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="485" SuggestedHeight="485" Brush="Panel.Dent" HorizontalAlignment="Center" VerticalAlignment="Top" MarginLeft="15" MarginTop="30">
              <Children>
                <BannerTableauWidget Id="BannerTableauWidget" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="475" SuggestedHeight="475" HorizontalAlignment="Center" VerticalAlignment="Center" BannerCodeText="@BannerCodeAsString" IsNineGrid="true">
                  <Children>
                    <BannerBuilderEditableAreaWidget DataSource="{CurrentSelectedLayer}" WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" EditableAreaVisualWidget="EditableAreaVisualWidget" DragWidgetRight="DragWidgetRight" DragWidgetTop="DragWidgetTop"  DragWidgetTopRight="DragWidgetTopRight" RotateWidget="RotateWidget" IsLayerPattern="@IsLayerPattern" IsMirrorActive="@IsMirrorActive" EditableAreaSize="@EditableAreaSize" TotalAreaSize="@TotalAreaSize" PositionValue="@PositionValue" SizeValue="@SizeValue" RotationValue="@RotationValue" Command.RefreshBanner="ExecuteUpdateBanner" BannerTableauWidget="..\..\BannerTableauWidget" LayerIndex="@LayerIndex">
                      <Children>
                        <!--Editable Area-->
                        <Widget Id="EditableAreaVisualWidget" Sprite="Panel.Dent" AlphaFactor="0.2" IsEnabled="false"/>

                        <!--Edges-->
                        <ButtonWidget Id="DragWidgetRight" SuggestedWidth="10" SuggestedHeight="10" Sprite="widget_circle" Brush.Color="#FF0000FF"/>
                        <ButtonWidget Id="DragWidgetTop" SuggestedWidth="10" SuggestedHeight="10" Sprite="widget_circle" Brush.Color="#00FF00FF"/>

                        <!--Corners-->
                        <ButtonWidget Id="DragWidgetTopRight" SuggestedWidth="10" SuggestedHeight="10" Sprite="widget_circle" Brush.Color="#0000FFFF"/>

                        <!--Rotate-->
                        <ButtonWidget Id="RotateWidget" SuggestedWidth="15" SuggestedHeight="15" Sprite="widget_circle" Color="#B0662AFF"/>

                      </Children>
                    </BannerBuilderEditableAreaWidget>
                  </Children>
                </BannerTableauWidget>

              </Children>
            </BrushWidget>

            <!--Layer Values-->
            <ListPanel DataSource="{CurrentSelectedLayer}" WidthSizePolicy="StretchToParent" HeightSizePolicy="Fixed" SuggestedHeight="45" VerticalAlignment="Bottom" MarginLeft="45" MarginBottom="12" StackLayout.LayoutMethod="HorizontalLeftToRight" IsHidden="false">
              <Children>
                <FloatLayerValueProperty Parameter.ValueText="W:" Parameter.FloatText="@SizeValueX" Parameter.MinFloat="0" Parameter.MaxFloat="1528"/>
                <FloatLayerValueProperty Parameter.ValueText="H:" Parameter.FloatText="@SizeValueY" Parameter.MinFloat="0" Parameter.MaxFloat="1528"/>
                <FloatLayerValueProperty Parameter.ValueText="X:" Parameter.FloatText="@PositionValueX" Parameter.MinFloat="0" Parameter.MaxFloat="9000" Parameter.MaxLength="4"/>
                <FloatLayerValueProperty Parameter.ValueText="Y:" Parameter.FloatText="@PositionValueY" Parameter.MinFloat="0" Parameter.MaxFloat="9000" Parameter.MaxLength="4"/>
                <IntLayerValueProperty Parameter.ValueText="R:" Parameter.IntText="@RotationValue360" Parameter.MinInt="0" Parameter.MaxInt="360" Parameter.MaxLength="4"/>
              </Children>
            </ListPanel>

          </Children>
        </BrushWidget>

        <!--Left Panel-->
        <BrushWidget Id="LeftPanel" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="470" SuggestedHeight="1090" HorizontalAlignment="Left" PositionXOffset="-15" PositionVerticalAlignment="Center" Brush="Panel.Background" DoNotUseCustomScaleAndChildren="true">
          <Children>

            <BrushListPanel WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" StackLayout.LayoutMethod="VerticalBottomToTop">
              <Children>

                <!--Title-->
                <TextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="Fixed" SuggestedHeight="55" HorizontalAlignment="Center" MarginTop="20" Brush="BannerBuilder.Title.Text" Text="@Title" />

                <BrushListPanel WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" StackLayout.LayoutMethod="HorizontalLeftToRight">
                  <Children>

                    <BrushListPanel WidthSizePolicy="Fixed" HeightSizePolicy="StretchToParent" SuggestedWidth="370" HorizontalAlignment="Left" VerticalAlignment="Center" MarginLeft="20" MarginTop="0" Brush="Panel.Dent" StackLayout.LayoutMethod="VerticalBottomToTop">
                      <Children>

                        <!--Icon Selection-->
                        <Widget Id="InnerPanel" WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" MarginRight="10">
                          <Children>

                            <ScrollablePanel Id="ScrollablePanel" WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" MarginTop="5" MarginBottom="5" AutoHideScrollBars="true" ClipRect="ClipRect" InnerPanel="ClipRect\Categories" VerticalScrollbar="..\VerticalScrollbar">
                              <Children>

                                <Widget Id="ClipRect" WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" ClipContents="true">
                                  <Children>

                                    <ListPanel DataSource="{Categories}" Id="Categories" WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" MarginRight="10" StackLayout.LayoutMethod="VerticalBottomToTop">
                                      <ItemTemplate>

                                        <!--Category-->
                                        <ListPanel WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" StackLayout.LayoutMethod="VerticalBottomToTop" IsVisible="@IsEnabled">
                                          <Children>

                                            <!--Category Collapser-->
                                            <PartyHeaderToggleWidget Id="CaravansToggleButton" ButtonType="Toggle" WidthSizePolicy="StretchToParent" HeightSizePolicy="Fixed" SuggestedHeight="50" MarginRight="5" MarginLeft="5" Brush="Collapsible.ButtonBrush" DoNotPassEventsToChildren="true" WidgetToClose="..\ItemsGrid" DominantSelectedState="false" CollapseIndicator="CategoryTogglePanel\CategoryCollapseIndicator" UpdateChildrenStates="true">
                                              <Children>
                                                <ListPanel Id="CategoryTogglePanel" WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" VerticalAlignment="Center" StackLayout.LayoutMethod="HorizontalLeftToRight">
                                                  <Children>
                                                    <TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" Brush="BannerBuilder.Collapsible.Text" Text="@Title" UpdateChildrenStates="true"/>
                                                    <BrushWidget Id="CategoryCollapseIndicator" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="25" SuggestedHeight="25" VerticalAlignment="Center" PositionYOffset="1" MarginRight="5" Brush="BannerBuilder.Category.CollapseIndicator"/>
                                                  </Children>
                                                </ListPanel>
                                              </Children>
                                            </PartyHeaderToggleWidget>

                                            <!--Category Grid-->
                                            <NavigatableGridWidget DataSource="{ItemsList}" Id="ItemsGrid" WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" ColumnCount="3" DefaultCellHeight="112" DefaultCellWidth="112" LayoutImp="GridLayout" >
                                              <ItemTemplate>
                                                <ButtonWidget DoNotPassEventsToChildren="true" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="104" SuggestedHeight="104" HorizontalAlignment="Center" VerticalAlignment="Center" Brush="FaceGen.Card" Command.Click="ExecuteSelection" IsSelected="@IsSelected" ClipContents="true" DoNotUseCustomScaleAndChildren="true">
                                                  <Children>
                                                    <Widget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" MarginLeft="2" MarginRight="2" MarginTop="2" MarginBottom="2" Sprite="@MeshIDAsString" AlphaFactor="0.8" />
                                                  </Children>
                                                </ButtonWidget>
                                              </ItemTemplate>
                                            </NavigatableGridWidget>
                                          </Children>
                                        </ListPanel>

                                      </ItemTemplate>
                                    </ListPanel>

                                  </Children>
                                </Widget>

                                <!--Scroll Gradient-->
                                <!--<Widget DoNotAcceptEvents="true" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="576" SuggestedHeight="57" HorizontalAlignment="Right" PositionXOffset="13" VerticalAlignment="Bottom" Sprite="General\CharacterCreation\character_creation_scroll_gradient" />  -->

                              </Children>
                            </ScrollablePanel>

                            <ScrollbarWidget Id="VerticalScrollbar" WidthSizePolicy="Fixed" HeightSizePolicy="StretchToParent" SuggestedWidth="8" HorizontalAlignment="Right" VerticalAlignment="Top" MarginTop="6" MarginBottom="15" MarginRight="0" AlignmentAxis="Vertical" Handle="VerticalScrollbarHandle"  MaxValue="100" MinValue="0" >
                              <Children>
                                <Widget WidthSizePolicy="Fixed" HeightSizePolicy="StretchToParent" SuggestedWidth="4" HorizontalAlignment="Center" Sprite="BlankWhiteSquare_9" Color="#5a4033FF" AlphaFactor="0.2" />
                                <ImageWidget Id="VerticalScrollbarHandle" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedHeight="10" SuggestedWidth="8" HorizontalAlignment="Center" Brush="FaceGen.Scrollbar.Handle" />
                              </Children>
                            </ScrollbarWidget>

                          </Children>
                        </Widget>

                      </Children>
                    </BrushListPanel>

                    <ListPanel WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" StackLayout.LayoutMethod="VerticalBottomToTop">
                      <Children>

                        <!--Transform Panel Collapser-->
                        <ButtonWidget ButtonType="Toggle" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="50" SuggestedHeight="50" VerticalAlignment="Top" MarginRight="5" MarginLeft="5" Brush="Inventory.Tuple.Extension.StockButton" DoNotPassEventsToChildren="true"  DominantSelectedState="false" IsSelected="@IsEditorPreviewActive">
                          <Children>
                            <BoolStateChangerWidget BooleanCheck="@IsEditorPreviewActive" TrueState="Default" FalseState="Disabled" TargetWidget="..\..\..\..\..\..\TransformPanel" />
                            <ListPanel WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" VerticalAlignment="Center" StackLayout.LayoutMethod="HorizontalLeftToRight" UpdateChildrenStates="true">
                              <Children>
                                <BrushWidget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="30" SuggestedHeight="30" Brush="Panel.Toggler.Transform"/>
                              </Children>
                            </ListPanel>
                          </Children>
                        </ButtonWidget>

                        <!--Layers Panel Collapser-->
                        <ButtonWidget ButtonType="Toggle" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="50" SuggestedHeight="50" VerticalAlignment="Top" MarginRight="5" MarginLeft="5" MarginTop="480" Brush="Inventory.Tuple.Extension.StockButton" DoNotPassEventsToChildren="true"  DominantSelectedState="false" IsSelected="@IsLayerPreviewActive">
                          <Children>
                            <BoolStateChangerWidget BooleanCheck="@IsLayerPreviewActive" TrueState="Default" FalseState="Disabled" TargetWidget="..\..\..\..\..\..\LayersPanel" />
                            <ListPanel WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" VerticalAlignment="Center" StackLayout.LayoutMethod="HorizontalLeftToRight" UpdateChildrenStates="true">
                              <Children>
                                <BrushWidget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="30" SuggestedHeight="30" Brush="Panel.Toggler.Layers"/>
                              </Children>
                            </ListPanel>
                          </Children>
                        </ButtonWidget>

                      
                    </Children>
                    </ListPanel>

                  </Children>
                </BrushListPanel>

                <!--Previous and Next Buttons-->
                <ListPanel WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" VerticalAlignment="Bottom" MarginBottom="10">
                  <Children>

                    <ButtonWidget DoNotPassEventsToChildren="true" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="125" SuggestedHeight="64" HorizontalAlignment="Right" VerticalAlignment="Center" MarginRight="10" Brush="Standard.BackButton" Command.Click="ExecuteCancel" UpdateChildrenStates="true">
                      <Children>
                        <InputKeyVisualWidget DataSource="{CancelInputKey}" DoNotAcceptEvents="true" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="45" SuggestedHeight="45" HorizontalAlignment="Left" VerticalAlignment="Center" PositionXOffset="-30" KeyID="@KeyID" IsVisible="@IsVisible"/>
                      </Children>
                    </ButtonWidget>

                    <ButtonWidget DoNotPassEventsToChildren="true" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="250" SuggestedHeight="64" HorizontalAlignment="Right" VerticalAlignment="Center" MarginLeft="10" Brush="Popup.Done.Button.NineGrid" Command.Click="ExecuteDone" UpdateChildrenStates="true">
                      <Children>
                        <TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="StretchToParent" HorizontalAlignment="Center" VerticalAlignment="Center" Brush="Popup.Button.Text" Text="@DoneText" />
                        <InputKeyVisualWidget DataSource="{DoneInputKey}" DoNotAcceptEvents="true" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="45" SuggestedHeight="45" HorizontalAlignment="Left" VerticalAlignment="Center" PositionXOffset="-30" KeyID="@KeyID" IsVisible="@IsVisible"/>
                      </Children>
                    </ButtonWidget>

                  </Children>
                </ListPanel>
              </Children>
            </BrushListPanel>

          </Children>
        </BrushWidget>


        <!--Color Selection Popup-->
        <BrushWidget DataSource="{ColorSelection}" WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" VerticalAlignment="Bottom" HorizontalAlignment="Left" MarginLeft="465" MarginBottom="90" Brush="Frame1.Border" IsVisible="@IsEnabled">
          <Children>

            <BrushWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" Brush="Frame1Canvas">
              <Children>
                <NavigatableGridWidget DataSource="{Items}" Id="PrimaryColorGrid" WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" ColumnCount="8" DefaultCellHeight="25" DefaultCellWidth="25" LayoutImp="GridLayout" VerticalAlignment="Center" MarginLeft="10" MarginRight="10" MarginBottom="10" >
                  <ItemTemplate>
                    <ColorButtonWidget DoNotPassEventsToChildren="true" WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" MarginLeft="3" MarginRight="3" MarginTop="3" MarginBottom="3" HorizontalAlignment="Center" VerticalAlignment="Center" Brush="Creation.ColorCard" ColorToApply="@ColorAsStr" ButtonType="Radio" UpdateChildrenStates="true" IsSelected="@IsSelected" Command.Click="ExecuteSelection" >
                      <Children>
                        <ImageWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" Brush="Creation.ColorCard.Selection"/>
                      </Children>
                    </ColorButtonWidget>
                  </ItemTemplate>
                </NavigatableGridWidget>
              </Children>
            </BrushWidget>

          </Children>
        </BrushWidget>


        <!--Banner Code Area-->
        <ListPanel WidthSizePolicy="CoverChildren" HeightSizePolicy="Fixed" SuggestedHeight="50" HorizontalAlignment="Left" VerticalAlignment="Bottom" MarginLeft="500" MarginBottom="10">
          <Children>

            <ButtonWidget DoNotPassEventsToChildren="true" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="21" SuggestedHeight="24" HorizontalAlignment="Left" VerticalAlignment="Top" MarginRight="15" Brush="Copy.Banner.Code.Button" Command.Click="ExecuteCopyBannerCode" UpdateChildrenStates="true">
              <Children>
              </Children>
            </ButtonWidget>

            <ScrollablePanel Id="ScrollablePanel" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="1200" SuggestedHeight="50" AutoHideScrollBars="true" ClipRect="ClipRect" InnerPanel="ClipRect\BannerCode" VerticalScrollbar="..\VerticalScrollbar" >
              <Children>

                <Widget Id="ClipRect" WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" ClipContents="true">
                  <Children>

                    <!--Banner Code-->
                    <TextWidget Id="BannerCode" WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" Brush="BannerBuilder.BannerCode.Text" Brush.TextHorizontalAlignment="Left" Text="@BannerCodeAsString"/>

                  </Children>
                </Widget>

                <!--Scroll Gradient-->
                <!--<Widget DoNotAcceptEvents="true" WidthSizePolicy="StretchToParent" HeightSizePolicy="Fixed" SuggestedHeight="57" HorizontalAlignment="Right" VerticalAlignment="Bottom" Sprite="General\CharacterCreation\character_creation_scroll_gradient" /> -->

              </Children>
            </ScrollablePanel>

            <ScrollbarWidget Id="VerticalScrollbar" WidthSizePolicy="Fixed" HeightSizePolicy="StretchToParent" SuggestedWidth="8" HorizontalAlignment="Right" VerticalAlignment="Top" MarginLeft="15" MarginTop="6" MarginBottom="15" AlignmentAxis="Vertical" Handle="VerticalScrollbarHandle" MaxValue="100" MinValue="0" >
              <Children>
                <Widget WidthSizePolicy="Fixed" HeightSizePolicy="StretchToParent" SuggestedWidth="4" HorizontalAlignment="Center" Sprite="BlankWhiteSquare_9" Color="#5a4033FF" AlphaFactor="0.2" />
                <ImageWidget Id="VerticalScrollbarHandle" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedHeight="10" SuggestedWidth="8" HorizontalAlignment="Center" Brush="FaceGen.Scrollbar.Handle" />
              </Children>
            </ScrollbarWidget>
          </Children>
        </ListPanel>

      </Children>
    </Widget>
  </Window>
</Prefab>