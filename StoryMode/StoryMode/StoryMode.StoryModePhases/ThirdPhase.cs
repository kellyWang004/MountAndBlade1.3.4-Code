using System.Collections.Generic;
using StoryMode.GameComponents.CampaignBehaviors;
using TaleWorlds.ActivitySystem;
using TaleWorlds.CampaignSystem;
using TaleWorlds.Library;
using TaleWorlds.SaveSystem;

namespace StoryMode.StoryModePhases;

public class ThirdPhase
{
	[SaveableField(1)]
	private readonly MBList<Kingdom> _oppositionKingdoms;

	[SaveableField(2)]
	private readonly MBList<Kingdom> _allyKingdoms;

	[SaveableProperty(3)]
	public bool IsCompleted { get; private set; }

	public MBReadOnlyList<Kingdom> OppositionKingdoms => (MBReadOnlyList<Kingdom>)(object)_oppositionKingdoms;

	public MBReadOnlyList<Kingdom> AllyKingdoms => (MBReadOnlyList<Kingdom>)(object)_allyKingdoms;

	internal static void AutoGeneratedStaticCollectObjectsThirdPhase(object o, List<object> collectedObjects)
	{
		((ThirdPhase)o).AutoGeneratedInstanceCollectObjects(collectedObjects);
	}

	protected virtual void AutoGeneratedInstanceCollectObjects(List<object> collectedObjects)
	{
		collectedObjects.Add(_oppositionKingdoms);
		collectedObjects.Add(_allyKingdoms);
	}

	internal static object AutoGeneratedGetMemberValueIsCompleted(object o)
	{
		return ((ThirdPhase)o).IsCompleted;
	}

	internal static object AutoGeneratedGetMemberValue_oppositionKingdoms(object o)
	{
		return ((ThirdPhase)o)._oppositionKingdoms;
	}

	internal static object AutoGeneratedGetMemberValue_allyKingdoms(object o)
	{
		return ((ThirdPhase)o)._allyKingdoms;
	}

	public ThirdPhase()
	{
		_oppositionKingdoms = new MBList<Kingdom>();
		_allyKingdoms = new MBList<Kingdom>();
		IsCompleted = false;
	}

	public void AddAllyKingdom(Kingdom kingdom)
	{
		((List<Kingdom>)(object)_allyKingdoms).Add(kingdom);
	}

	public void AddOppositionKingdom(Kingdom kingdom)
	{
		((List<Kingdom>)(object)_oppositionKingdoms).Add(kingdom);
	}

	public void RemoveOppositionKingdom(Kingdom kingdom)
	{
		((List<Kingdom>)(object)_oppositionKingdoms).Remove(kingdom);
	}

	public void CompleteThirdPhase(QuestCompleteDetails defeatTheConspiracyQuestCompleteDetail)
	{
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_0009: Invalid comparison between Unknown and I4
		//IL_0019: Unknown result type (might be due to invalid IL or missing references)
		//IL_001b: Invalid comparison between Unknown and I4
		//IL_001d: Unknown result type (might be due to invalid IL or missing references)
		//IL_001f: Invalid comparison between Unknown and I4
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0032: Unknown result type (might be due to invalid IL or missing references)
		//IL_0034: Invalid comparison between Unknown and I4
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_0038: Invalid comparison between Unknown and I4
		IsCompleted = true;
		if ((int)defeatTheConspiracyQuestCompleteDetail == 1)
		{
			ActivityManager.EndActivity("CompleteMainQuest", (ActivityOutcome)2);
		}
		else if ((int)defeatTheConspiracyQuestCompleteDetail == 4 || (int)defeatTheConspiracyQuestCompleteDetail == 2 || (int)defeatTheConspiracyQuestCompleteDetail == 0)
		{
			ActivityManager.EndActivity("CompleteMainQuest", (ActivityOutcome)0);
		}
		else if ((int)defeatTheConspiracyQuestCompleteDetail == 3 || (int)defeatTheConspiracyQuestCompleteDetail == 5)
		{
			ActivityManager.EndActivity("CompleteMainQuest", (ActivityOutcome)1);
		}
		Campaign.Current.CampaignBehaviorManager.RemoveBehavior<ThirdPhaseCampaignBehavior>();
	}
}
