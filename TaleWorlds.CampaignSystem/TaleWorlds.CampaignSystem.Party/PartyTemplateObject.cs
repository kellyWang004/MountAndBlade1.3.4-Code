using System;
using System.Collections.Generic;
using System.Xml;
using TaleWorlds.Core;
using TaleWorlds.Library;
using TaleWorlds.ObjectSystem;

namespace TaleWorlds.CampaignSystem.Party;

public sealed class PartyTemplateObject : MBObjectBase
{
	public MBList<PartyTemplateStack> Stacks;

	public MBList<ShipTemplateStack> ShipHulls;

	internal static void AutoGeneratedStaticCollectObjectsPartyTemplateObject(object o, List<object> collectedObjects)
	{
		((PartyTemplateObject)o).AutoGeneratedInstanceCollectObjects(collectedObjects);
	}

	protected override void AutoGeneratedInstanceCollectObjects(List<object> collectedObjects)
	{
		base.AutoGeneratedInstanceCollectObjects(collectedObjects);
	}

	public override void Deserialize(MBObjectManager objectManager, XmlNode node)
	{
		Stacks = new MBList<PartyTemplateStack>();
		ShipHulls = new MBList<ShipTemplateStack>();
		base.Deserialize(objectManager, node);
		foreach (XmlNode childNode in node.ChildNodes)
		{
			if (childNode.Name == "stacks")
			{
				foreach (XmlNode childNode2 in childNode.ChildNodes)
				{
					if (childNode2.Name == "PartyTemplateStack")
					{
						PartyTemplateStack item = new PartyTemplateStack((CharacterObject)objectManager.ReadObjectReferenceFromXml("troop", typeof(CharacterObject), childNode2), Convert.ToInt32(childNode2.Attributes["min_value"].Value), Convert.ToInt32(childNode2.Attributes["max_value"].Value));
						Stacks.Add(item);
					}
				}
			}
			else
			{
				if (!(childNode.Name == "ship_hulls"))
				{
					continue;
				}
				foreach (XmlNode childNode3 in childNode.ChildNodes)
				{
					if (childNode3.Name == "ShipTemplateStack")
					{
						ShipTemplateStack item2 = new ShipTemplateStack((ShipHull)objectManager.ReadObjectReferenceFromXml("id", typeof(ShipHull), childNode3), Convert.ToInt32(childNode3.Attributes["min_value"].Value), Convert.ToInt32(childNode3.Attributes["max_value"].Value));
						ShipHulls.Add(item2);
					}
				}
			}
		}
	}

	public int GetUpperTroopLimit()
	{
		int num = 0;
		foreach (PartyTemplateStack stack in Stacks)
		{
			num += stack.MaxValue;
		}
		return num;
	}

	public int GetLowerTroopLimit()
	{
		int num = 0;
		foreach (PartyTemplateStack stack in Stacks)
		{
			num += stack.MinValue;
		}
		return num;
	}
}
