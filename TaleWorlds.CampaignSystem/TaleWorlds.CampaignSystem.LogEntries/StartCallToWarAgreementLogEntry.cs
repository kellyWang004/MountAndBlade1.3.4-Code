using System.Collections.Generic;
using TaleWorlds.Localization;
using TaleWorlds.ObjectSystem;
using TaleWorlds.SaveSystem;

namespace TaleWorlds.CampaignSystem.LogEntries;

public class StartCallToWarAgreementLogEntry : LogEntry, IEncyclopediaLog, IChatNotification
{
	[SaveableField(10)]
	private readonly Kingdom _callingKingdom;

	[SaveableField(20)]
	private readonly Kingdom _calledKingdom;

	[SaveableField(30)]
	private readonly Kingdom _kingdomToCallToWarAgainst;

	public override CampaignTime KeepInHistoryTime => CampaignTime.Years(4f);

	public bool IsVisibleNotification => true;

	public override ChatNotificationType NotificationType => DiplomaticNotification(_callingKingdom, _kingdomToCallToWarAgainst);

	internal static void AutoGeneratedStaticCollectObjectsStartCallToWarAgreementLogEntry(object o, List<object> collectedObjects)
	{
		((StartCallToWarAgreementLogEntry)o).AutoGeneratedInstanceCollectObjects(collectedObjects);
	}

	protected override void AutoGeneratedInstanceCollectObjects(List<object> collectedObjects)
	{
		base.AutoGeneratedInstanceCollectObjects(collectedObjects);
		collectedObjects.Add(_callingKingdom);
		collectedObjects.Add(_calledKingdom);
		collectedObjects.Add(_kingdomToCallToWarAgainst);
	}

	internal static object AutoGeneratedGetMemberValue_callingKingdom(object o)
	{
		return ((StartCallToWarAgreementLogEntry)o)._callingKingdom;
	}

	internal static object AutoGeneratedGetMemberValue_calledKingdom(object o)
	{
		return ((StartCallToWarAgreementLogEntry)o)._calledKingdom;
	}

	internal static object AutoGeneratedGetMemberValue_kingdomToCallToWarAgainst(object o)
	{
		return ((StartCallToWarAgreementLogEntry)o)._kingdomToCallToWarAgainst;
	}

	public StartCallToWarAgreementLogEntry(Kingdom callingKingdom, Kingdom calledKingdom, Kingdom kingdomToCallToWarAgainst)
	{
		_callingKingdom = callingKingdom;
		_calledKingdom = calledKingdom;
		_kingdomToCallToWarAgainst = kingdomToCallToWarAgainst;
	}

	public override string ToString()
	{
		return GetEncyclopediaText().ToString();
	}

	public TextObject GetNotificationText()
	{
		TextObject textObject = new TextObject("{=UtnItjeJ}The {CALLING_KINGDOM_LINK} has called on the {CALLED_KINGDOM_LINK} to declare war against the {KINGDOM_TO_CALL_TO_WAR_AGAINST_LINK}.");
		textObject.SetTextVariable("CALLING_KINGDOM_LINK", _callingKingdom.EncyclopediaLinkWithName);
		textObject.SetTextVariable("CALLED_KINGDOM_LINK", _calledKingdom.EncyclopediaLinkWithName);
		textObject.SetTextVariable("KINGDOM_TO_CALL_TO_WAR_AGAINST_LINK", _kingdomToCallToWarAgainst.EncyclopediaLinkWithName);
		return textObject;
	}

	public bool IsVisibleInEncyclopediaPageOf<T>(T obj) where T : MBObjectBase
	{
		if ((object)obj != _callingKingdom)
		{
			return (object)obj == _calledKingdom;
		}
		return true;
	}

	public TextObject GetEncyclopediaText()
	{
		TextObject textObject = new TextObject("{=UtnItjeJ}The {CALLING_KINGDOM_LINK} has called on the {CALLED_KINGDOM_LINK} to declare war against the {KINGDOM_TO_CALL_TO_WAR_AGAINST_LINK}.");
		textObject.SetTextVariable("CALLING_KINGDOM_LINK", _callingKingdom.EncyclopediaLinkWithName);
		textObject.SetTextVariable("CALLED_KINGDOM_LINK", _calledKingdom.EncyclopediaLinkWithName);
		textObject.SetTextVariable("KINGDOM_TO_CALL_TO_WAR_AGAINST_LINK", _kingdomToCallToWarAgainst.EncyclopediaLinkWithName);
		return textObject;
	}
}
