using System.Collections.Generic;
using TaleWorlds.CampaignSystem.Party;
using TaleWorlds.CampaignSystem.Settlements;
using TaleWorlds.Localization;
using TaleWorlds.ObjectSystem;
using TaleWorlds.SaveSystem;

namespace TaleWorlds.CampaignSystem.LogEntries;

public class CommonAreaFightLogEntry : LogEntry, IEncyclopediaLog
{
	[SaveableField(170)]
	private readonly TextObject _attackerName;

	[SaveableField(171)]
	private readonly TextObject _defenderName;

	[SaveableField(172)]
	private readonly Settlement _settlement;

	internal static void AutoGeneratedStaticCollectObjectsCommonAreaFightLogEntry(object o, List<object> collectedObjects)
	{
		((CommonAreaFightLogEntry)o).AutoGeneratedInstanceCollectObjects(collectedObjects);
	}

	protected override void AutoGeneratedInstanceCollectObjects(List<object> collectedObjects)
	{
		base.AutoGeneratedInstanceCollectObjects(collectedObjects);
		collectedObjects.Add(_attackerName);
		collectedObjects.Add(_defenderName);
		collectedObjects.Add(_settlement);
	}

	internal static object AutoGeneratedGetMemberValue_attackerName(object o)
	{
		return ((CommonAreaFightLogEntry)o)._attackerName;
	}

	internal static object AutoGeneratedGetMemberValue_defenderName(object o)
	{
		return ((CommonAreaFightLogEntry)o)._defenderName;
	}

	internal static object AutoGeneratedGetMemberValue_settlement(object o)
	{
		return ((CommonAreaFightLogEntry)o)._settlement;
	}

	public CommonAreaFightLogEntry(MobileParty attackerParty, MobileParty defenderParty, Hero attackerHero, Settlement settlement)
	{
		_attackerName = ((attackerParty != null) ? attackerParty.Name : attackerHero.Name);
		_defenderName = defenderParty.Name;
		_settlement = settlement;
	}

	public override string ToString()
	{
		return GetEncyclopediaText().ToString();
	}

	public bool IsVisibleInEncyclopediaPageOf<T>(T obj) where T : MBObjectBase
	{
		return (object)obj == _settlement;
	}

	public TextObject GetEncyclopediaText()
	{
		TextObject textObject = new TextObject("{=A3ql1SUy}{PARTY_1} attacked a common area belonging to {PARTY_2} in {SETTLEMENT}.");
		textObject.SetTextVariable("PARTY_1", _attackerName);
		textObject.SetTextVariable("PARTY_2", _defenderName);
		textObject.SetTextVariable("SETTLEMENT", _settlement.EncyclopediaLinkWithName);
		return textObject;
	}
}
