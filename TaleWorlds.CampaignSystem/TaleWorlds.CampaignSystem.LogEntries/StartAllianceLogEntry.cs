using System.Collections.Generic;
using TaleWorlds.Localization;
using TaleWorlds.ObjectSystem;
using TaleWorlds.SaveSystem;

namespace TaleWorlds.CampaignSystem.LogEntries;

public class StartAllianceLogEntry : LogEntry, IEncyclopediaLog, IChatNotification
{
	[SaveableField(10)]
	private readonly Kingdom _kingdom1;

	[SaveableField(20)]
	private readonly Kingdom _kingdom2;

	public override CampaignTime KeepInHistoryTime => CampaignTime.Years(4f);

	public bool IsVisibleNotification => true;

	public override ChatNotificationType NotificationType => DiplomaticNotification(_kingdom1, _kingdom2);

	internal static void AutoGeneratedStaticCollectObjectsStartAllianceLogEntry(object o, List<object> collectedObjects)
	{
		((StartAllianceLogEntry)o).AutoGeneratedInstanceCollectObjects(collectedObjects);
	}

	protected override void AutoGeneratedInstanceCollectObjects(List<object> collectedObjects)
	{
		base.AutoGeneratedInstanceCollectObjects(collectedObjects);
		collectedObjects.Add(_kingdom1);
		collectedObjects.Add(_kingdom2);
	}

	internal static object AutoGeneratedGetMemberValue_kingdom1(object o)
	{
		return ((StartAllianceLogEntry)o)._kingdom1;
	}

	internal static object AutoGeneratedGetMemberValue_kingdom2(object o)
	{
		return ((StartAllianceLogEntry)o)._kingdom2;
	}

	public StartAllianceLogEntry(Kingdom kingdom1, Kingdom kingdom2)
	{
		_kingdom1 = kingdom1;
		_kingdom2 = kingdom2;
	}

	public override string ToString()
	{
		return GetEncyclopediaText().ToString();
	}

	public TextObject GetNotificationText()
	{
		TextObject textObject = new TextObject("{=0cdXddA9}The {KINGDOM1_LINK} have formed an alliance with the {KINGDOM2_LINK}.");
		textObject.SetTextVariable("KINGDOM1_LINK", _kingdom1.EncyclopediaLinkWithName);
		textObject.SetTextVariable("KINGDOM2_LINK", _kingdom2.EncyclopediaLinkWithName);
		return textObject;
	}

	public bool IsVisibleInEncyclopediaPageOf<T>(T obj) where T : MBObjectBase
	{
		if ((object)obj != _kingdom1)
		{
			return (object)obj == _kingdom2;
		}
		return true;
	}

	public TextObject GetEncyclopediaText()
	{
		TextObject textObject = new TextObject("{=0cdXddA9}The {KINGDOM1_LINK} have formed an alliance with the {KINGDOM2_LINK}.");
		textObject.SetTextVariable("KINGDOM1_LINK", _kingdom1.EncyclopediaLinkWithName);
		textObject.SetTextVariable("KINGDOM2_LINK", _kingdom2.EncyclopediaLinkWithName);
		return textObject;
	}
}
