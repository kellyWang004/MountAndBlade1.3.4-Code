using System.Collections.Generic;
using Helpers;
using TaleWorlds.Core;
using TaleWorlds.Library;
using TaleWorlds.Localization;

namespace TaleWorlds.CampaignSystem.CharacterDevelopment;

public sealed class PerkObject : PropertyObject
{
	public static MBReadOnlyList<PerkObject> All => Campaign.Current.AllPerks;

	public SkillObject Skill { get; private set; }

	public float RequiredSkillValue { get; private set; }

	public PerkObject AlternativePerk { get; private set; }

	public PartyRole PrimaryRole { get; private set; }

	public PartyRole SecondaryRole { get; private set; }

	public float PrimaryBonus { get; private set; }

	public float SecondaryBonus { get; private set; }

	public EffectIncrementType PrimaryIncrementType { get; private set; }

	public EffectIncrementType SecondaryIncrementType { get; private set; }

	public TroopUsageFlags PrimaryTroopUsageMask { get; private set; }

	public TroopUsageFlags SecondaryTroopUsageMask { get; private set; }

	public TextObject PrimaryDescription { get; private set; }

	public TextObject SecondaryDescription { get; private set; }

	public bool IsTrash
	{
		get
		{
			if (!(base.Name == null) && !(base.Description == null))
			{
				return Skill == null;
			}
			return true;
		}
	}

	internal static void AutoGeneratedStaticCollectObjectsPerkObject(object o, List<object> collectedObjects)
	{
		((PerkObject)o).AutoGeneratedInstanceCollectObjects(collectedObjects);
	}

	protected override void AutoGeneratedInstanceCollectObjects(List<object> collectedObjects)
	{
		base.AutoGeneratedInstanceCollectObjects(collectedObjects);
	}

	public PerkObject(string stringId)
		: base(stringId)
	{
	}

	public void Initialize(string name, SkillObject skill, int requiredSkillValue, PerkObject alternativePerk, string primaryDescription, PartyRole primaryRole, float primaryBonus, EffectIncrementType incrementType, string secondaryDescription = "", PartyRole secondaryRole = PartyRole.None, float secondaryBonus = 0f, EffectIncrementType secondaryIncrementType = EffectIncrementType.Invalid, TroopUsageFlags primaryTroopUsageMask = TroopUsageFlags.Undefined, TroopUsageFlags secondaryTroopUsageMask = TroopUsageFlags.Undefined)
	{
		PrimaryDescription = new TextObject(primaryDescription);
		SecondaryDescription = new TextObject(secondaryDescription);
		StringHelpers.SetEffectIncrementTypeTextVariable("VALUE", PrimaryDescription, primaryBonus, incrementType);
		TextObject textObject;
		if (secondaryDescription != "")
		{
			StringHelpers.SetEffectIncrementTypeTextVariable("VALUE", SecondaryDescription, secondaryBonus, secondaryIncrementType);
			textObject = GameTexts.FindText("str_string_newline_newline_string");
			textObject.SetTextVariable("STR1", PrimaryDescription);
			textObject.SetTextVariable("STR2", SecondaryDescription);
		}
		else
		{
			textObject = PrimaryDescription.CopyTextObject();
		}
		textObject.SetTextVariable("newline", "\n");
		Initialize(new TextObject(name), textObject);
		Skill = skill;
		RequiredSkillValue = requiredSkillValue;
		AlternativePerk = alternativePerk;
		if (alternativePerk != null)
		{
			alternativePerk.AlternativePerk = this;
		}
		PrimaryRole = primaryRole;
		SecondaryRole = secondaryRole;
		PrimaryBonus = primaryBonus;
		SecondaryBonus = secondaryBonus;
		PrimaryIncrementType = incrementType;
		SecondaryIncrementType = ((secondaryIncrementType == EffectIncrementType.Invalid) ? PrimaryIncrementType : secondaryIncrementType);
		PrimaryTroopUsageMask = primaryTroopUsageMask;
		SecondaryTroopUsageMask = secondaryTroopUsageMask;
		AfterInitialized();
	}

	public override string ToString()
	{
		return base.Name?.ToString() ?? base.StringId;
	}
}
